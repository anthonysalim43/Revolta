{
  "devices": {
    "SMA/SunnyBoy": {
      "connection": { "unit_id": 3, "default_fc": 4 },
      "word_order":"msw_lsw",
      "signals": { 
        "device_type": {"read": {"ref": 30053, "fc": 4, "dtype": "u32", "scale": 1, "unit": "" } }, 
        "inverter_ac_power":   {"read": {"ref": 30775, "fc": 4, "dtype": "s32", "scale": 1, "unit": "W"} },
        "bat_charge":    {"read": {"ref": 31393, "fc": 4, "dtype": "s32", "scale": 1, "unit": "W" } },
        "bat_discharge": {"read": {"ref": 31395, "fc": 4, "dtype": "s32", "scale": 1, "unit": "W" } }
      },
       "derived": {
        "pv_power": { "expr": "inverter_ac_power - bat_discharge + bat_charge", "unit": "W" }
      }
    },
    "SMA/SunnyIsland": {
      "connection": { "unit_id": 3, "default_fc": 4 },
      "word_order":"msw_lsw",
      "signals": {


        "device_type": {"read": {"ref": 30053, "fc": 4, "dtype": "u32", "scale": 1, "unit": ""} },

        "grid_power":  {"read": {"ref": 30775, "fc": 4, "dtype": "s32", "scale": 1, "unit": "W"} },

        "grid_voltage_L1": {"read": {"ref": 30783, "fc": 4, "dtype": "u32", "scale": 100, "unit": "V" } },
        "grid_voltage_L2": {"read": {"ref": 30785, "fc": 4, "dtype": "u32", "scale": 100, "unit": "V" } },
        "grid_voltage_L3": {"read": {"ref": 30787, "fc": 4, "dtype": "u32", "scale": 100, "unit": "V" } },

        "grid_current_L1": {"read": {"ref": 30977, "fc": 4, "dtype": "s32", "scale": 1000, "unit": "A" } },
        "grid_current_L2": {"read": {"ref": 30979, "fc": 4, "dtype": "s32", "scale": 1000, "unit": "A" } },
        "grid_current_L3": {"read": {"ref": 30981, "fc": 4, "dtype": "s32", "scale": 1000, "unit": "A" } },


        "bat_charge": {"read": { "ref": 31393, "fc": 4, "dtype": "s32", "scale": 1, "unit": "W" } },
        "bat_discharge": {"read": { "ref": 31395, "fc": 4, "dtype": "s32", "scale": 1, "unit": "W" } },
        "bat_current": {"read": { "ref": 30843, "fc": 4, "dtype": "s32", "scale": 1000, "unit": "A" } },
        "bat_voltage": {"read": { "ref": 30851, "fc": 4, "dtype": "u32", "scale": 100, "unit": "V" } },
        "bat_SoC": {"read": { "ref": 30845, "fc": 4, "dtype": "u32", "scale": 1, "unit": "%" } },
        "bat_size_Wh": {"read": { "ref": 40187, "fc": 4, "dtype": "u32", "scale": 1, "unit": "Wh" } },

        


        "load_power": {"read": {"ref": 30861, "fc": 4, "dtype": "s32", "scale": 1, "unit": "W"} },

        "pv_power": {"read": { "ref": 30869, "fc": 4, "dtype": "s32", "scale": 1, "unit": "W" } },
        "pv_current": {"read": { "ref": 31011, "fc": 4, "dtype": "u32", "scale": 1000, "unit": "A" } },


        "grid_power_out":  {"read": { "ref": 30865, "fc": 4, "dtype": "s32", "scale": 1, "unit": "W" } },
        "grid_feedin": {"read":  { "ref": 30867, "fc": 4, "dtype": "s32", "scale": 1, "unit": "W" } },
       
        
        "power_setpoint": {"write": { "ref": 40149, "fc": 16, "dtype": "s32", "scale": 1, "unit": "W"} },
        "enable_power_exchange": {"write": {  "ref": 40151, "fc": 16, "dtype": "u32", "scale": 1, "unit": ""} },

        "wm_mode_cfg":  {
          "read": {"ref": 40210, "fc": 4, "dtype": "u32", "scale": 1, "unit": ""} ,
          "write":{"ref": 40210, "fc": 16, "dtype": "u32", "scale": 1, "unit": ""} },


        "max_charge_current_A":{
          "read": { "ref": 40045, "fc": 4, "dtype": "u32", "scale": 1000, "unit": "A" },
          "write": { "ref": 40045, "fc": 16, "dtype": "u32", "scale": 1000, "unit": "A" } },

        "max_discharge_current_A": { 
          "read": { "ref": 40083, "fc": 4, "dtype": "u32", "scale": 1000, "unit": "A" },
          "write": { "ref": 40083, "fc": 16, "dtype": "u32", "scale": 1000, "unit": "A"} },

        
        "power_setpoint_timeout": { 
          "read": { "ref": 41195, "fc": 3, "dtype": "u32", "scale": 1, "unit": "s" },
          "write": {"ref": 41195, "fc": 16, "dtype": "u32", "scale": 1, "unit": "s"} },

        

        "power_setpoint_fallback": {
         "read":{ "ref": 41193, "fc": 3, "dtype": "u32", "scale": 1, "unit": ""},
         "write": { "ref": 41193, "fc": 16, "dtype": "u32", "scale": 1, "unit": "" } },


        "power_setpoint_fallback_value": { 
          "read":{"ref": 44037, "fc": 3, "dtype": "s32", "scale": 100, "unit": "W"},
          "write": { "ref": 44037, "fc": 16, "dtype": "s32", "scale": 100, "unit": "W"} }
    },

      "derived": {
        "grid_average_voltage": { "expr": "(grid_voltage_L1 + grid_voltage_L2 + grid_voltage_L3)/3", "unit": "V" },
        "grid_average_current": { "expr": "(grid_current_L1 + grid_current_L2 + grid_current_L3)/3", "unit": "A" },
        "max_battery_charge_power" : {"expr": "max_charge_current_A * bat_voltage", "unit": "W"},
        "max_battery_discharge_power" : {"expr": "max_discharge_current_A * bat_voltage", "unit": "W"},
        "pv_voltage": {"expr": "pv_power / pv_current", "unit": "V"}
      }
    },
    "VictronEnergy/MultiGridII": {
      "connection": { "unit_id": 100, "default_fc": 3 },
      "word_order":"msw_lsw",
      "signals": {
        "device_type":{"read":{ "ref": 800, "fc": 3, "dtype": "u64", "scale": 1, "unit": "" } },
        
        "battery_power": {"read" :{"ref": 842, "fc": 3, "dtype": "s16", "scale": 1, "unit": "W"} },
        
        "grid_power_l1":{"read": {"ref": 820, "fc": 3, "dtype": "s16", "scale": 1, "unit": "W" } },
        "grid_power_l2":{"read": {"ref": 821, "fc": 3, "dtype": "s16", "scale": 1, "unit": "W"} },
        "grid_power_l3":{"read": {"ref": 822, "fc": 3, "dtype": "s16", "scale": 1, "unit": "W" } }

        
      },
      "derived": {
        "grid_power":   { "expr": "grid_power_l1 + grid_power_l2 + grid_power_l3 ", "unit": "W" },
        "bat_charge": { "expr": "battery_power if battery_power > 0 else 0", "unit": "W" },
        "bat_discharge": { "expr": "(-battery_power) if battery_power < 0 else 0", "unit": "W" }
      }
    },
    "Et340" :{
      "connection": {"port": "COM5","baudrate": 9600,"parity": "N","stopbits": 1,"bytesize": 8,"timeout": 1,"unit_id": 1},
      "word_order":"lsw_msw",
      "signals": {
        "grid_voltage_L1": { "read": { "ref": 0,  "fc": 4, "dtype": "s32", "scale": 10,   "unit": "V" } },
        "grid_voltage_L2": { "read": { "ref": 2,  "fc": 4, "dtype": "s32", "scale": 10,   "unit": "V" } },
        "grid_voltage_L3": { "read": { "ref": 4,  "fc": 4, "dtype": "s32", "scale": 10,   "unit": "V" } },

        "grid_current_L1": { "read": { "ref": 12, "fc": 4, "dtype": "s32", "scale": 1000, "unit": "A" } },
        "grid_current_L2": { "read": { "ref": 14, "fc": 4, "dtype": "s32", "scale": 1000, "unit": "A" } },
        "grid_current_L3": { "read": { "ref": 16, "fc": 4, "dtype": "s32", "scale": 1000, "unit": "A" } },

        "grid_active_power_W": { "read": { "ref": 40, "fc": 4, "dtype": "s32", "scale": 10, "unit": "W" } }
      }
    }
  }
}

    